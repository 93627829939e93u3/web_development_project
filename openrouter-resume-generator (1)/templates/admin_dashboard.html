{% extends "base.html" %}

{% block title %}Admin Dashboard - Enhanced Resume Generator{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="header">
            <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
            <div style="margin-top: 15px;">
                <a href="{{ url_for('index') }}" class="btn btn-secondary">
                    <i class="fas fa-home"></i> Back to App
                </a>
                <a href="{{ url_for('admin_logout') }}" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-success">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="grid">
            <div>
                <h3>OpenRouter API Configuration</h3>
                <form method="POST" action="{{ url_for('update_api_key') }}">
                    <div class="form-group">
                        <label for="api_key">OpenRouter API Key</label>
                        <input type="password" id="api_key" name="api_key" value="{{ api_key }}" required>
                        <small style="color: #666;">Get your API key from <a href="https://openrouter.ai/keys" target="_blank">OpenRouter Dashboard</a></small>
                    </div>
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Update API Key
                    </button>
                </form>
            </div>
            
            <div>
                <h3>System Status</h3>
                <div style="padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <p><strong>Total Templates:</strong> {{ templates|length }}</p>
                    <p><strong>API Status:</strong> 
                        {% if api_key %}
                            <span style="color: green;">âœ“ Configured</span>
                        {% else %}
                            <span style="color: red;">âœ— Not Configured</span>
                        {% endif %}
                    </p>
                    <p><strong>Database:</strong> <span style="color: green;">âœ“ Connected</span></p>
                    <p><strong>Features:</strong> Dynamic Lists, Profile Photos, Section Toggles, Inline Editing</p>
                </div>
            </div>
        </div>
        
        <div style="margin-top: 40px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Resume Templates</h3>
                <button class="btn" onclick="document.getElementById('addTemplateModal').style.display='block'">
                    <i class="fas fa-plus"></i> Add New Template
                </button>
            </div>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">ID</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Name</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Thumbnail</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Created</th>
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for template in templates %}
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">{{ template[0] }}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">{{ template[1] }}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">
                                {% if template[3] %}
                                    <img src="/template_thumbnails/{{ template[3] }}" alt="Thumbnail" style="width: 50px; height: 30px; object-fit: cover; border-radius: 4px;">
                                {% else %}
                                    <span style="color: #666;">No image</span>
                                {% endif %}
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">{{ template[6] if template|length > 6 else 'N/A' }}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #dee2e6;">
                                <a href="{{ url_for('test_template', template_id=template[0]) }}" class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;">
                                    <i class="fas fa-vial"></i> Test
                                </a>
                                <a href="{{ url_for('edit_template', template_id=template[0]) }}" class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <form method="POST" action="{{ url_for('delete_template', template_id=template[0]) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this template?')">
                                    <button type="submit" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Add Template Modal -->
        <div id="addTemplateModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 600px; max-height: 90%; overflow-y: auto;">
                <h3 style="margin-bottom: 20px;">Add New Template</h3>
                <form method="POST" action="{{ url_for('add_template') }}" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="modal_name">Template Name *</label>
                        <input type="text" id="modal_name" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal_thumbnail">Template Thumbnail</label>
                        <input type="file" id="modal_thumbnail" name="thumbnail" accept="image/*">
                        <small style="color: #666;">Upload a preview image for the template gallery</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal_html">HTML Template *</label>
                        <textarea id="modal_html" name="html_content" style="width: 100%; height: 200px; font-family: monospace;" required placeholder="Enter HTML template with Jinja2 syntax..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal_css">CSS Styles *</label>
                        <textarea id="modal_css" name="css_content" style="width: 100%; height: 150px; font-family: monospace;" required placeholder="Enter CSS styles..."></textarea>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button type="submit" class="btn">
                            <i class="fas fa-plus"></i> Add Template
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('addTemplateModal').style.display='none'">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <div style="margin-top: 40px;">
            <h3>Enhanced Features</h3>
            <div class="grid">
                <div>
                    <h4>âœ¨ New Features Added</h4>
                    <ul style="margin-left: 20px; color: #666;">
                        <li>Dynamic lists for education, skills, experience, projects, interests</li>
                        <li>Profile photo upload and management</li>
                        <li>Section show/hide toggles</li>
                        <li>Inline content editing with AI regeneration</li>
                        <li>Language selector for projects</li>
                        <li>Enhanced form validation</li>
                    </ul>
                </div>
                <div>
                    <h4>ðŸ”§ System Management</h4>
                    <p>All enhanced features are working seamlessly with the existing OpenRouter AI integration.</p>
                    <button class="btn btn-secondary" onclick="alert('System running optimally!')">
                        <i class="fas fa-check-circle"></i> System Check
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
